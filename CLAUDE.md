# Project Structure

This is a Quarto website with embedded React + D3 interactive applications. Quarto handles the static site (pages, navigation, styling), and each interactive app is a self-contained React project that gets built and embedded via iframe.

## Layout

```
project-root/
  _quarto.yml          # Quarto site config (navbar, theme, resources)
  index.qmd            # Landing page
  page-name.qmd        # Page that embeds a React app via iframe
  app-name/            # Self-contained React + D3 app
    package.json       # App dependencies (react, d3, etc.)
    package-lock.json  # Pinned dependency versions
    vite.config.js     # Vite build config (must have base: './')
    index.html         # HTML entry point (boilerplate)
    node_modules/      # Installed packages (not committed to git)
    src/
      main.jsx         # Bootstrap (mounts App into the DOM)
      App.jsx          # The actual app (UI + logic + D3 viz)
      App.css          # App styles
    dist/              # Built output (generated by npm run build)
      index.html
      assets/
```

Multiple apps can coexist as sibling folders, each with their own `package.json` and `src/`. Each one is completely independent.

## How apps are embedded

Each `.qmd` page embeds a React app by iframing its built output:

````qmd
```{=html}
<iframe src="app-name/dist/index.html" width="100%" height="600" style="border:none;"></iframe>
```
````

The `_quarto.yml` must list each app's dist folder as a resource so Quarto copies it into `_site/`:

```yaml
project:
  type: website
  resources:
    - app-name/dist/**
```

## Workflow

1. **Develop a React app:** `cd app-name && npm run dev` -- Vite serves it with hot reload
2. **Build for embedding:** `cd app-name && npm run build` -- compiles into `app-name/dist/`
3. **Preview the Quarto site:** `quarto preview` (from project root)
4. **Deploy:** `quarto render` then deploy `_site/` to any static host

Always rebuild the React app (`npm run build`) before previewing or rendering the Quarto site. The Quarto site serves the built files from `dist/`, not the live dev server.

## React + D3 app conventions

Each React app follows the same structure:

- **`vite.config.js`** must include `base: './'` so built assets use relative paths (required for iframe embedding and for the built files to work outside of a dev server).
- **`src/App.jsx`** contains all the app logic. `useState` for reactive inputs, `useMemo` for computed values (like D3 binning/scales), and the JSX return for the UI layout and SVG chart.
- **`src/App.css`** controls the app's visual appearance. These styles are scoped to the iframe and won't conflict with Quarto's site styles.
- **`src/main.jsx`** is boilerplate that mounts the App component. Rarely needs editing.
- **`index.html`** is boilerplate that loads main.jsx. Rarely needs editing.

## Adding a new app

1. Copy an existing app folder and rename it
2. `cd new-app && npm install`
3. Edit `src/App.jsx` and `src/App.css`
4. Add `new-app/dist/**` to `resources` in `_quarto.yml`
5. Create a new `.qmd` page with an iframe pointing to `new-app/dist/index.html`
6. Build with `cd new-app && npm run build`

## Key dependencies

- **react** -- UI framework, handles reactivity and rendering
- **d3** -- Data processing and visualization (scales, binning, axes, data loading)
- **vite** -- Dev server with hot reload + production bundler

## Things to know

- The React apps are fully client-side. No server is needed at runtime, which is why they can be embedded in a static Quarto site.
- Each app's `dist/` folder should be committed to git (or rebuilt in CI) since the Quarto site depends on it.
- The iframe creates a clean boundary: the app's CSS and JavaScript are isolated from Quarto's page styles.
- D3 is used for data operations (scales, binning, data loading) while React handles the DOM. The chart is rendered as SVG elements in JSX, not by D3's DOM manipulation.
